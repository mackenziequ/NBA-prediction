---
title: "Multivariate linear regression: A data driven approach to predicting midseason NBA point spreads"
author: "Mackenzie Qu"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  pdf_document: default
  bookdown::pdf_document2:
    citation_package: natbib
abstract: |
  |From the squeak of shoes on the court to the klaton of a shot clock buzzer, the excitment of basketball lies within its fast and unperdictable nature, which gradifies a massive crowd of gamblers. For the purpose of predicting pointspread outcome for any midseason NBA games, multiple regression models are developed using team's previous game stats from the same season. The model shows an 83% accuracy within 3 points, which is then tested using randomly selected midseason games from 2015-2018. Our model for pointspread is also applicable with regards to predicting the Money Line outcome, which may provide an overview of the upcoming season betting lines.
  |
  |Keywords: basketball, Bayesian logistic regression, multivariate linear regression, NBA, pointspread
bibliography: reference.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
# Used Packages
library(tidyverse)
library(dplyr)
library(haven)
library(tidyr)
library(knitr)
library(kableExtra)
library(readr)
library(AICcmodavg)
library(broom)
library(corrr)
library(brms)
### Data ###
# Import Data
games_stats <- read_csv("nba.games.stats.csv")
head(games_stats)
# Clean Data
# Create point spread variable column
games_stats <- games_stats%>%
  mutate(PointSpread=TeamPoints-OpponentPoints)

games_stats <- games_stats%>%
  mutate(DateNum=as.numeric(gsub("-","",Date)))

games_stats <- games_stats%>%
  mutate_at(vars(WINorLOSS), .funs = 
              funs(case_when(.=="W"~1,
                             .=="L"~0)))
# We have chosen to use 2014season to build our model
stats_2014 <- 
  games_stats %>% 
  select(Team, 
         Opponent, 
         Home,
         Game, 
         Date, 
         WINorLOSS,
         PointSpread,
         TeamPoints, 
         OpponentPoints, 
         FieldGoalPercent = FieldGoals., 
         OppFieldGoalPercent = Opp.FieldGoals., 
         ThreePointPercent = X3PointShots., 
         OppThreePointPercent = Opp.3PointShots.,
         FreeThrowPercent = FreeThrows.,
         OppFreeThrowPercent = Opp.FreeThrows.,
         TotalRebounds,
         OppTotalRebound = Opp.TotalRebounds,
         Turnovers,
         OppTurnover = Opp.Turnovers)%>%
  filter(games_stats$DateNum>=20141028& games_stats$DateNum<=20150616& #filter szn
           Home=="Home") # filter home game only to avoid repetition

# We will use games randomly chosen from 2015 to 2018 to verify 
# our model accuracy

```


# Introduction
Basketball has gained millions of passionate fans over the years, and its intensity often extends beyond the courts into various bets. As the NBA remains to be the best basketball league in the world, the betting market of it also holds significant value. The NBA is composed of 30 teams; each team plays 83 games for a regular season which provides 1230 opportunities for gamblers to cash in. The most popular basketball bet is the Money Line, in which bettors simply choose a desired team to win. A more intriguing bet on point spread, however, has been selected to be the main focus in this report as it also includes the Money Line results. Point spread is when one bets on a team to win by a specific number or not lose more than that number. In this paper, we experimented with both multivariate linear regression model and Bayesian regression model with @citeR, hoping to predict a profitable betting line on the spreads of NBA games.

For the purpose of this paper, actual NBA game statistics(@cite_data) from 2014 to 2018 are used to assist the model development. The data includes all games in a season, along with game stats such as field goal percentage and 3 point percentage generated by each team. We have chosen to use the the average of field goal percentage, 3 point percentage, free throw percentage, total rebounds, assists, and turnovers of both team as predictor variables. In addition, we have also used a Bayesian logistic regression to predict the general outcome for each game. Our model for point spread has a residual standard error of 3.8, which is inadequate in accuracy in comparison to the betting lines. However, the Bayesian model for predicting the winning team appears to be significantly accurate through verification.

The result could potentially be used to predict point-spread in the upcoming NBA season. However, the model is not sufficient enough to achieve the accuracy of the NBA betting lines chosen by professional oddsmakers. Our model could be significantly improved by adding the actually in-game statistics as a predictor. The rest of the report proceeds as follows. Section 2 describes the historical NBA data we have used to develop and verify the models, including some adjustments made. In section 3, we demonstrate various models including multivariate linear regression and Bayesian regression, aiming to provide statistical reasoning behind the results. Section 4 shows the result of the models and verifies the model performance through randomly selected games and their betting lines respectively. In which the results will be discussed thoroughly in section 5, as well as some potential weaknesses and future work. 
# Data


# Model
field goal percentage~team+opponent+avg field goal percentage+Opp avg


point spread(team points-opponent points) ~  team + opponent_team + predicted_field_goal_percentage(past game avg home or opp) + predicted_opponent_field_goal_percentage + predicted_3point_percent + predicted_opponent3point_percent
```{r, include=FALSE}

```

# Result


# Discussion


# Apendix


# Reference

